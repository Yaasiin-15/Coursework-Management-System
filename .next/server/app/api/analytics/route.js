"use strict";(()=>{var e={};e.id=1567,e.ids=[1567],e.modules={11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},87848:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>b,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{GET:()=>p});var s=r(49303),n=r(88716),i=r(60670),o=r(87070),u=r(14184),m=r(49397),d=r(44837),l=r(93330),c=r(95456);async function p(e){try{let t=e.headers.get("authorization")?.replace("Bearer ","");if(!t)return o.NextResponse.json({error:"No token provided"},{status:401});let r=(0,c.WX)(t);if(!r||!["teacher","admin"].includes(r.role))return o.NextResponse.json({error:"Unauthorized"},{status:403});let{searchParams:a}=new URL(e.url),s=a.get("range")||"6months";await (0,u.Z)();let n=new Date,i=new Date;switch(s){case"1month":i.setMonth(n.getMonth()-1);break;case"3months":i.setMonth(n.getMonth()-3);break;case"6months":default:i.setMonth(n.getMonth()-6);break;case"1year":i.setFullYear(n.getFullYear()-1)}let p=await l.Z.countDocuments({role:"student"}),g=await m.Z.countDocuments({createdAt:{$gte:i}}),h=await d.Z.find({marks:{$exists:!0,$ne:null},createdAt:{$gte:i}}).populate("assignmentId","maxMarks"),y=0,f=0;h.forEach(e=>{y+=e.marks,f+=e.assignmentId.maxMarks});let x=f>0?y/f*100:0,b=await d.Z.countDocuments({createdAt:{$gte:i}}),q=g*p,S=[{grade:"A (90-100%)",min:90,max:100},{grade:"B (80-89%)",min:80,max:89},{grade:"C (70-79%)",min:70,max:79},{grade:"D (60-69%)",min:60,max:69},{grade:"F (0-59%)",min:0,max:59}].map(e=>{let t=h.filter(t=>{let r=t.marks/t.assignmentId.maxMarks*100;return r>=e.min&&r<=e.max}).length;return{grade:e.grade,count:t}}),k=[];for(let e=5;e>=0;e--){let t=new Date(n.getFullYear(),n.getMonth()-e,1),r=new Date(n.getFullYear(),n.getMonth()-e+1,0),a=h.filter(e=>e.createdAt>=t&&e.createdAt<=r),s=0,i=0;a.forEach(e=>{s+=e.marks,i+=e.assignmentId.maxMarks});let o=i>0?s/i*100:0;k.push({month:t.toLocaleDateString("en-US",{month:"short",year:"numeric"}),average:Math.round(10*o)/10})}let v=new Map;h.forEach(e=>{let t=e.studentId.toString();v.has(t)||v.set(t,{total:0,maxTotal:0,name:""});let r=v.get(t);r.total+=e.marks,r.maxTotal+=e.assignmentId.maxMarks});let w=[];for(let[e,t]of Array.from(v.entries())){let r=await l.Z.findById(e,"name");r&&t.maxTotal>0&&w.push({name:r.name,average:t.total/t.maxTotal*100})}w.sort((e,t)=>t.average-e.average),w.splice(5);let I=await m.Z.aggregate([{$match:{createdAt:{$gte:i}}},{$lookup:{from:"submissions",localField:"_id",foreignField:"assignmentId",as:"submissions"}},{$project:{title:1,maxMarks:1,submissions:{$filter:{input:"$submissions",cond:{$ne:["$$this.marks",null]}}}}},{$project:{title:1,submissions:{$size:"$submissions"},average:{$cond:{if:{$gt:[{$size:"$submissions"},0]},then:{$multiply:[{$divide:[{$avg:"$submissions.marks"},"$maxMarks"]},100]},else:0}}}},{$limit:10}]);return o.NextResponse.json({totalStudents:p,totalAssignments:g,averageGrade:Math.round(10*x)/10,submissionRate:Math.round(10*(q>0?b/q*100:0))/10,gradeDistribution:S,performanceTrend:k,topPerformers:w,assignmentStats:I})}catch(e){return console.error("Error fetching analytics:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"C:\\Users\\Hp\\Desktop\\Full-Stack Projects\\Course\\src\\app\\api\\analytics\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:f}=g,x="/api/analytics/route";function b(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:y})}},95456:(e,t,r)=>{r.d(t,{Oe:()=>l,RA:()=>u,WX:()=>m,c_:()=>d});var a=r(41482),s=r.n(a),n=r(42023),i=r.n(n);let o=process.env.JWT_SECRET||"your-secret-key";function u(e){return s().sign(e,o,{expiresIn:"7d"})}function m(e){try{return s().verify(e,o)}catch(e){return null}}async function d(e){return i().hash(e,12)}async function l(e,t){return i().compare(e,t)}},14184:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(11185),s=r.n(a);let n=process.env.MONGODB_URI||"mongodb://localhost:27017/coursework-management";if(!n)throw Error("Please define the MONGODB_URI environment variable");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null});let o=async function(){if(i.conn)return i.conn;i.promise||(i.promise=s().connect(n,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},49397:(e,t,r)=>{r.d(t,{Z:()=>i});var a=r(11185),s=r.n(a);let n=new(s()).Schema({title:{type:String,required:[!0,"Title is required"],trim:!0},description:{type:String,required:[!0,"Description is required"]},course:{type:String,required:[!0,"Course is required"],trim:!0},deadline:{type:Date,required:[!0,"Deadline is required"]},maxMarks:{type:Number,required:[!0,"Maximum marks is required"],min:1},createdBy:{type:s().Schema.Types.ObjectId,ref:"User",required:!0},classId:{type:s().Schema.Types.ObjectId,ref:"Class",required:!0}},{timestamps:!0}),i=s().models.Assignment||s().model("Assignment",n)},44837:(e,t,r)=>{r.d(t,{Z:()=>i});var a=r(11185),s=r.n(a);let n=new(s()).Schema({assignmentId:{type:s().Schema.Types.ObjectId,ref:"Assignment",required:!0},studentId:{type:s().Schema.Types.ObjectId,ref:"User",required:!0},fileUrl:{type:String,required:[!0,"File URL is required"]},fileName:{type:String,required:[!0,"File name is required"]},marks:{type:Number,min:0},feedback:{type:String},submittedAt:{type:Date,default:Date.now},gradedAt:{type:Date},gradedBy:{type:s().Schema.Types.ObjectId,ref:"User"},status:{type:String,enum:["submitted","graded","late"],default:"submitted"},plagiarismCheck:{similarity:{type:Number,min:0,max:1},matches:[{text:String,startIndex:Number,endIndex:Number,matchedWith:String}],report:String,checkedAt:Date,checkedBy:{type:s().Schema.Types.ObjectId,ref:"User"}}},{timestamps:!0});n.index({assignmentId:1,studentId:1},{unique:!0});let i=s().models.Submission||s().model("Submission",n)},93330:(e,t,r)=>{r.d(t,{Z:()=>i});var a=r(11185),s=r.n(a);let n=new(s()).Schema({name:{type:String,required:[!0,"Name is required"],trim:!0},email:{type:String,required:[!0,"Email is required"],unique:!0,lowercase:!0,trim:!0},role:{type:String,enum:["student","teacher","admin"],required:[!0,"Role is required"]},passwordHash:{type:String,required:[!0,"Password is required"]},notificationSettings:{emailNotifications:{type:Boolean,default:!0},assignmentReminders:{type:Boolean,default:!0},gradeNotifications:{type:Boolean,default:!0},systemUpdates:{type:Boolean,default:!1}},preferences:{language:{type:String,default:"en"},theme:{type:String,default:"system"}},classId:{type:s().Schema.Types.ObjectId,ref:"Class",required:function(){return"student"===this.role}}},{timestamps:!0}),i=s().models.User||s().model("User",n)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,5972,6944],()=>r(87848));module.exports=a})();